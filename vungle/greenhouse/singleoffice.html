<!doctype html>
<html>
	<head>
		<title>Greenhouse</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<style type="text/css">
		html, body {
			background-color: #000;
			color: #ccc;
			}	
		a {
			color:#2f90ce;
		}
		</style>
	</head>
	
<body>

	
	
	<script>
		
		// pulls id from query string parameter using regEx
		/*
		function getParameterByName(name){
			name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
			var regex = new RegExp("[\\?&]"+name+"=([^&#]*)"),
				results = regex.exec(location.search);
			return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));	
		};
		
		var jobid = getParameterByName('id');
		
		console.log(jobid);
		*/
		
		// Grabs query string
		function getQueryVariable(variable)
		{
		       var query = window.location.search.substring(1);
		       var vars = query.split("&");
		       for (var i=0;i<vars.length;i++) {
		               var pair = vars[i].split("=");
		               if(pair[0] == variable){return pair[1];}
		       }
		       return(false);
		       
		}
		var queryid = getQueryVariable('office');
		var query = getQueryVariable('id');
		
		
		console.log(queryid);
		console.log(query);
		
		
		
		
		var greenuri = 'https://api.greenhouse.io/v1/boards/vungle/embed/'
		
		var jobs = greenuri+'jobs';
		var offices = greenuri+'offices';
		var departments = greenuri+'departments';
		var jobsByOffice = greenuri+'jobs'+'?id='+queryid;
		
		$.ajax({
		    url: jobs,
		    type: "GET",
		    dataType: 'jsonp',
		    cache: true,
		    data: {content: true, questions: true}, //loads job content & questions into new objectS
		    context: document.body,
		    success: function (data, status, error) {
		      //console.log('success', data);
		      
		      //grabs the name of the office from the first listing and creates h1 title
		     // $('#location').append(data.jobs[0].offices[0].name);

			  
			 /* if (queryid === jobLocationUrl) {
				  	console.log(data.jobs.location.name + 'hi');
				  };
			  */
			  
			  
			
			  
			  
			  
			  
			  for(i = 0; i < data.jobs.length; i++){
				  var jobLocation = data.jobs[i].offices[0].name; // office location eg SF
				  
				  //console.log(jobLocation);
				  
				  var jobLocationUrl = jobLocation.toLowerCase().replace(/\s+/g, '');
				  //console.log(jobLocation);
				  
				
				  
				  if (queryid === jobLocationUrl) {
					  //console.log(data.jobs);
					  
					  
					  
					  var jobstitle = data.jobs[i].title;
					  var vungleurl = 'singlejob.html?id=';
					  var jobsurl = vungleurl+data.jobs[i].id;
					  var jobslocation = data.jobs[i].location.name;
					  
					  var jobsid = data.jobs[i].id;
					  
					  
					  $('#office').append('<h2><a href="'+jobsurl+'" alt="'+jobstitle+'">'+jobstitle+'</a></h2><p>'+jobslocation+' '+jobsid+'</p>');
					  
				  }
				 
				  
			  }
			  	
			  	//adds location to header
			   $('#location').append(jobslocation);

		      
		    },
		    error: function (data, status, error) {
		      console.log('error', data, status, error);
		    }
		});
		
		
		
		

		
	</script>
	
	
	<div class="container"><div class="row"><div class="col-sm-12">
	
	
	<h1 id="location" class="text-center"><!-- location --></h1>
	<hr />
		
	<div id="office"></div>
	
	</div></div></div>
	

</body>
</html>